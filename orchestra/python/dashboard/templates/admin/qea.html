{% extends 'admin/master.html' %}
{% block body %}
{{ super() }}

{% if current_user.is_authenticated %}

<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Cluster 
    <small>Q&A</small>
</h1>
<ol class="breadcrumb">
    <li><a href="/admin"><i class="fa fa-dashboard"></i> Home</a></li>
    <li class="active"><i class="fa fa-info-circle"></i> Q&A</li>
</ol>
</section>

<section class="content">

  <!-- main row -->
  <div class="row">

  <!-- Single question section -->
  <section class="col-lg-12">
    <!-- Box div -->
    <div class="box box-solid bg-black-gradient" style="height: 100%">
      <!-- Box content -->
      <div class="box-body border-radius-none">
        <p><b>
          Onde posso encontrar documentação sobre como utilizar o Cluster?
        </b></p>
        <p>
          A interação com o cluster é feita através do Maestro. Ela pode ser realizada através da CLI ou Python. <br>
          A documentação do Maestro é a seguinte: <a href="https://maestro-lps.readthedocs.io/en/latest/">https://maestro-lps.readthedocs.io/en/latest/</a>
        </p>
      </div>
      <!-- // Box content -->
    </div>
    <!-- // Box div -->
  </section>
  <!-- // Single question section -->

  <!-- Single question section -->
  <section class="col-lg-12">
    <!-- Box div -->
    <div class="box box-solid bg-black-gradient" style="height: 100%">
      <!-- Box content -->
      <div class="box-body border-radius-none">
        <p><b>
          Qual a função das <i>configFiles</i>? Como posso gerá-las? Tem um modelo pra isso? E como eu posso configurar meu ambiente de execução?
        </b></p>
        <p>
          Para explicar conceitos como esse, pode-se utilizar um exemplo como o disponibilizado em <a href="https://github.com/gabriel-milan/stocks-prediction">https://github.com/gabriel-milan/stocks-prediction</a>. <br>
          * Uma <i>TASK</i> contém múltiplas <i>JOBs</i>. No exemplo desse repositório acima, a <i>TASK</i> é a predição dos valores da BOVESPA usando LSTM e os dados dos últimos 60 dias. As <i>JOBs</i> são treinamentos de diferentes modelos de forma que seja possível avaliar qual o melhor modelo para realização de tal tarefa;<br>
          * Todo o ambiente (bibliotecas, pacotes, variáveis de ambiente, softwares, compiladores, etc.) no qual a sua tarefa será realizada deve estar configurado em uma imagem Docker de sua preferência e disponibilizado de forma pública no DockerHub. Somente dessa forma, o cluster poderá realizar download dela e colocá-la pra rodar;<br>
          * Um <i>configFile</i> é referente a uma única <i>JOB</i>. No caso da predição da BOVESPA, um <i>configFile</i> diz respeito ao modelo selecionado para uma <i>JOB</i>. O formato do seu <i>configFile</i> é arbitrário, você monta e seu programa entende. Para esse exemplo, foram utilizados arquivos JSON gerados pelo Keras.<br>
        </p>
      </div>
      <!-- // Box content -->
    </div>
    <!-- // Box div -->
  </section>
  <!-- // Single question section -->

  <!-- Single question section -->
  <section class="col-lg-12">
    <!-- Box div -->
    <div class="box box-solid bg-black-gradient" style="height: 100%">
      <!-- Box content -->
      <div class="box-body border-radius-none">
        <p><b>
          No exemplo, o gerador de <i>configFiles</i> gera os modelos para cada <i>JOB</i> e os armazena em uma pasta com nome padronizado (user.nomeusuario ...). Essa pasta com esses modelos tambem deve estar dentro da imagem que sera utilizada para geracao dos containers?
        </b></p>
        <p>
          Não é necessário que os <i>configFiles</i> estejam na imagem Docker. Você deverá realizar o upload deles usando o Maestro. Para o caso do exemplo você poderia fazê-lo da seguinte maneira:<br>
            <br>
            Esse comando irá mostrar as opções do maestro:<br>
            -> maestro -h<br>
            <br>
            Esse comando irá mostrar as opções do maestro castor:<br>
            -> maestro castor -h<br>
            <br>
            Esse comando irá mostrar as opções do maestro castor upload:<br>
            -> maestro castor upload -h<br>
            <br>
            Esse comando fará o upload das configFiles:<br>
            -> maestro castor upload -d user.gabriel-milan.bovespa_prediction_lstm_60 -p user.gabriel-milan.bovespa_prediction_lstm_60<br>
            -> Nesse caso, o argumento "-d" tem relação com o nome do dataset que ficará registrado no cluster e o argumento -p tem relação com o path da pasta onde se encontram os configFiles<br>
            <br>
            Após o upload, você poderá verificar sua integridade com o comando:<br>
            -> maestro castor list -u (meusuario)<br>
        </p>
      </div>
      <!-- // Box content -->
    </div>
    <!-- // Box div -->
  </section>
  <!-- // Single question section -->

  <!-- Single question section -->
  <section class="col-lg-12">
    <!-- Box div -->
    <div class="box box-solid bg-black-gradient" style="height: 100%">
      <!-- Box content -->
      <div class="box-body border-radius-none">
        <p><b>
          Percebi que o campo outputFile não é passado na chamada do "maestro task create", apesar de ser utilizado para salvar o modelo treinado após a realizacao de um determinado job. O nome do outputFile é gerado automaticamente de acordo com a job que foi completado?
        </b></p>
        <p>
          Sim, o outputFile tem nome gerado automaticamente, que coincide com o nome da sua task. No exemplo que estamos usando, seria possível observar com o comando "maestro castor list -u (usuario)" um arquivo com o nome user.gabriel-milan.bovespa_prediction_lstm_60_standard, que estaria se referindo à task gerada pelo nosso exemplo.
        </p>
      </div>
      <!-- // Box content -->
    </div>
    <!-- // Box div -->
  </section>
  <!-- // Single question section -->

  <!-- Single question section -->
  <section class="col-lg-12">
    <!-- Box div -->
    <div class="box box-solid bg-black-gradient" style="height: 100%">
      <!-- Box content -->
      <div class="box-body border-radius-none">
        <p><b>
          Como são recuperados os arquivos com os resultados, visto que eles são criados dentro dos containers isoladamente?
        </b></p>
        <p>
          Os resultados, assim como quaisquer datasets e configFiles presentes no maestro castor, podem ser baixados com o comando:<br>
          -> maestro castor download -d (nome-do-arquivo)<br>
          -> Para o caso de múltiplos arquivos, ele será zipado<br>        </p>
      </div>
      <!-- // Box content -->
    </div>
    <!-- // Box div -->
  </section>
  <!-- // Single question section -->

  <!-- Single question section -->
  <section class="col-lg-12">
    <!-- Box div -->
    <div class="box box-solid bg-black-gradient" style="height: 100%">
      <!-- Box content -->
      <div class="box-body border-radius-none">
        <p><b>
          As jobs são executadas paralela ou sequencialmente?
        </b></p>
        <p>
          O nosso cluster consiste em várias máquinas com configurações diferentes, capacidade de memória diferente, número de GPUs e CPUs diferente, etc. A sequência de execução das jobs é feita conforme a sua prioridade nas filas. Observe que existem duas filas de execução de jobs: a fila de CPU e a fila de GPU. Você escolhe pra onde enviar sua task usando a flag "--gpu" no comando "maestro task create (args)". Cada usuário começa com prioridade 1000 e essa é recalculada de forma constante da seguinte forma: <a href="https://twiki.cern.ch/twiki/bin/view/PanDA/PandaAthena#Job_priority">https://twiki.cern.ch/twiki/bin/view/PanDA/PandaAthena#Job_priority</a>. Para resumo de história, pode ser que suas jobs sejam executadas todas ao mesmo tempo, dependendo da disponibilidade de recursos e da fila, e também pode ser que sejam executadas aos poucos, conforme sua prioridade ultrapasse a de outros usuários e os recursos sejam liberados. De qualquer forma, você pode acompanhar em tempo real a disposição de suas jobs tanto com o comando "maestro task list -u (usuario)" quanto aqui pelo dashboard.
        </p>
      </div>
      <!-- // Box content -->
    </div>
    <!-- // Box div -->
  </section>
  <!-- // Single question section -->

  <!-- Single question section -->
  <section class="col-lg-12">
    <!-- Box div -->
    <div class="box box-solid bg-black-gradient" style="height: 100%">
      <!-- Box content -->
      <div class="box-body border-radius-none">
        <p><b>
          Mais dúvidas?
        </b></p>
        <p>
          Entre em contato com nossa staff:<br>
          gabriel.milan@lps.ufrj.br<br>
          jodafons@lps.ufrj.br<br>
          micael.verissimo@lps.ufrj.br<br>
          pedro.lisboa@lps.ufrj.br
        </p>
      </div>
      <!-- // Box content -->
    </div>
    <!-- // Box div -->
  </section>
  <!-- // Single question section -->

  </div>
  <!-- /.row (main row) -->
</section>
<!-- /.content -->
{% else %}

{% include "admin/logged_out.html" %}

{% endif %}

  {% endblock body %}
